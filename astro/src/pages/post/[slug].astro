---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { buildTagLink, type TagLink } from '../../utils/tags';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const title = post.data.title ?? post.slug;
const formattedDate = post.data.date
  ? new Intl.DateTimeFormat('en-US', { dateStyle: 'long' }).format(post.data.date)
  : undefined;
const tags = (post.data.tags ?? [])
  .map(buildTagLink)
  .filter((tag): tag is TagLink => Boolean(tag));
---
<BaseLayout title={title}>
  <article>
    <p style="margin: 0 0 0.35rem;">
      <a href="/beta/">‚Üê back home</a>
    </p>
    <h1 style="margin: 0 0 0.5rem;">{title}</h1>
    {formattedDate && <div style="color: #bdbdbd; margin-bottom: 1rem;">{formattedDate}</div>}
    {tags.length > 0 && (
      <div style="margin-bottom: 1.25rem; display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
        <strong style="font-size: 0.95rem; color: #dedede;">Tags:</strong>
        {tags.map((tag) => (
          <a
            href={tag.href}
            style="background: #1a1a1a; color: #f4f4f4; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.9rem; border: 1px solid #2a2a2a;"
          >
            {tag.name}
          </a>
        ))}
      </div>
    )}
    <div class="post-body">
      <Content />
    </div>
  </article>
  <style>
    .post-body {
      padding: 1.25rem;
      border-radius: 12px;
      background: #111111;
      border: 1px solid #1f1f1f;
      color: #f2f2f2;
    }

    .post-body img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1rem auto;
    }

    .post-body pre {
      background: #050505;
      border-radius: 10px;
      padding: 1rem;
      overflow-x: auto;
      border: 1px solid #1f1f1f;
    }

    .post-body code {
      font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 0.95rem;
    }

    .post-body h2,
    .post-body h3,
    .post-body h4 {
      margin-top: 1.5rem;
    }

    .post-body p {
      margin: 0.85rem 0;
    }

    .post-body ul,
    .post-body ol {
      padding-left: 1.25rem;
    }
  </style>
</BaseLayout>
